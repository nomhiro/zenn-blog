---
title: "NLWebã‚µãƒ¼ãƒãƒ¼ã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã§å‹•ã‹ãã†ï¼"
emoji: "ğŸš€"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["nlweb", "microsoft", "ai", "llm"]
published: false
---

https://zenn.dev/nomhiro/articles/what-is-nlweb-2025-ms-build

# PoCâ‘ ï¼šNLWebã‚µãƒ¼ãƒãƒ¼ã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã§å‹•ã‹ãã†ï¼ğŸš€

**å‰ææ¡ä»¶**  
- **Python 3.10ä»¥ä¸Š**ãŒãƒ­ãƒ¼ã‚«ãƒ«ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹ã“ã¨
- Azure OpenAI ã« **gpt-4.1, gpt-4.1-mini, text-embedding-3-small** ã®ãƒ¢ãƒ‡ãƒ«ãŒãƒ‡ãƒ—ãƒ­ã‚¤ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã€‚
  - ![](/images/poc-nlweb-20250524/2025-05-24-17-43-37.png)


### 1. ã‚³ãƒ¼ãƒ‰ã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰

ã¾ãšã€NLWebã®ãƒªãƒã‚¸ãƒˆãƒªã‚’ã‚¯ãƒ­ãƒ¼ãƒ³ã—ã¾ã™ã€‚

```sh
git clone https://github.com/microsoft/NLWeb
cd NLWeb
```

### 2. Pythonä»®æƒ³ç’°å¢ƒã®ä½œæˆã¨æœ‰åŠ¹åŒ–

æ¬¡ã«ã€Pythonã®ä»®æƒ³ç’°å¢ƒã‚’ä½œæˆã—ã¦ã€æœ‰åŠ¹åŒ–ã—ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå°‚ç”¨ã®ç’°å¢ƒã§å¿…è¦ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãŒç®¡ç†ã§ãã¾ã™ã€‚

```sh
python -m venv myenv
myenv\Scripts\activate
```

### 3. ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

NLWebã®`code`ãƒ•ã‚©ãƒ«ãƒ€ã«ç§»å‹•ã—ã€ä¾å­˜ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚’è¡Œã„ã¾ã™ã€‚ã“ã®æ‰‹é †ã§ã€ãƒ­ãƒ¼ã‚«ãƒ«ã®ãƒ™ã‚¯ãƒˆãƒ«ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¦æ±‚ã‚‚å«ã‚ãŸã™ã¹ã¦ã®å¿…è¦ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãŒè‡ªå‹•çš„ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¾ã™ã€‚

```sh
cd code
pip install -r requirements.txt
```

### 4. è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®æº–å‚™

#### 4-1. .envãƒ•ã‚¡ã‚¤ãƒ«ã®ä½œæˆ

`.env.template`ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚³ãƒ”ãƒ¼ã—ã¦æ–°ã—ã„`.env`ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¾ã™ã€‚  
ã“ã“ã§ã¯ã€ä½¿ç”¨ã™ã‚‹**LLMã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®APIã‚­ãƒ¼**ã‚’è¨­å®šã—ã¾ã™ã€‚ãƒ­ãƒ¼ã‚«ãƒ«ã®Qdrantãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®å¤‰æ•°ã¯ã™ã§ã«è¨­å®šæ¸ˆã¿ã§ã™ã€‚

```sh
cp .env.template .env
```

ä»¥ä¸‹ã®ç’°å¢ƒå¤‰æ•°ã‚’è¨­å®šã—ã¾ã™ã€‚
```
AZURE_OPENAI_ENDPOINT="Azure OpenAI ã® API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ"
AZURE_OPENAI_API_KEY="Azure OpenAI ã® API ã‚­ãƒ¼"

QDRANT_URL="http://localhost:6333"
QDRANT_API_KEY="<OPTIONAL>"
```

â€» å¿…è¦ã«å¿œã˜ã¦ã€`.env`ãƒ•ã‚¡ã‚¤ãƒ«å†…ã®APIã‚­ãƒ¼ãªã©ã‚’ãŠä½¿ã„ã®ç’°å¢ƒã«åˆã‚ã›ã¦ç·¨é›†ã—ã¦ãã ã•ã„ã€‚

#### 4-2. è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®æ›´æ–°

`code/config`ãƒ•ã‚©ãƒ«ãƒ€å†…ã®3ã¤ã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ›´æ–°ã—ã¾ã™ã€‚ã“ã‚Œã‚‰ã®ãƒ•ã‚¡ã‚¤ãƒ«ã§ã€ä½¿ç”¨ã™ã‚‹ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã‚’è‡ªåˆ†ã®ç’°å¢ƒã«åˆã‚ã›ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

- **config_llm.yaml**  
  - preferred_providerã‚’ã€LLMãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã«åˆã‚ã›ã¦æ›´æ–°ã—ã¾ã—ã‚‡ã†ã€‚ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯ã€ŒAzure OpenAIã€ã«ãªã£ã¦ã„ã¾ã™ã€‚ 
  - åˆ©ç”¨ã™ã‚‹ãƒ¢ãƒ‡ãƒ«ï¼ˆä¾‹ï¼š4.1ã€4.1-miniï¼‰ã‚‚ã“ã“ã§å¤‰æ›´ã—ã¾ã™ã€‚â€»NLWebã¨ã—ã¦ã¯4.1ã‚„4.1-miniã®æƒ³å®šã§ä½œã‚‰ã‚Œã¦ã„ã‚‹ã‚ˆã†ã§ã™ã€‚

:::details config_llm.yaml
```yaml
preferred_provider: azure_openai

providers:
  inception:
    api_key_env: INCEPTION_API_KEY
    api_endpoint_env: INCEPTION_ENDPOINT
    models:
      high: mercury-small
      low: mercury-small

  openai:
    api_key_env: OPENAI_API_KEY
    api_endpoint_env: OPENAI_ENDPOINT
    models:
      high: gpt-4.1
      low: gpt-4.1-mini

  anthropic:
    api_key_env: ANTHROPIC_API_KEY
    models:
      high: claude-3-5-sonnet-20241022
      low: claude-3-haiku-20240307

  gemini:
    api_key_env: GCP_PROJECT
    models:
      high: chat-bison@001
      low: chat-bison-lite@001

  azure_openai:
    api_key_env: AZURE_OPENAI_API_KEY
    api_endpoint_env: AZURE_OPENAI_ENDPOINT
    api_version_env: "2024-12-01-preview"
    models:
      high: gpt-4.1
      low: gpt-4.1-mini

  llama_azure:
    api_key_env: LLAMA_AZURE_API_KEY
    api_endpoint_env: LLAMA_AZURE_ENDPOINT
    api_version_env: "2024-12-01-preview"
    models:
      high: llama-2-70b
      low: llama-2-13b

  deepseek_azure:
    api_key_env: DEEPSEEK_AZURE_API_KEY
    api_endpoint_env: DEEPSEEK_AZURE_ENDPOINT
    api_version_env: "2024-12-01-preview"
    models:
      high: deepseek-coder-33b
      low: deepseek-coder-7b

      
  snowflake:
    api_key_env: SNOWFLAKE_PAT
    api_endpoint_env: SNOWFLAKE_ACCOUNT_URL
    api_version_env: "2024-12-01"
    models:
      high: claude-3-5-sonnet
      low: llama3.1-8b
```
:::

- **config_embedding.yaml**  
  - æœ€ä¸Šè¡Œã‚’ã€å¸Œæœ›ã™ã‚‹åŸ‹ã‚è¾¼ã¿ï¼ˆembeddingï¼‰ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã«æ›´æ–°ã—ã¾ã™ã€‚ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯ã€ŒAzure OpenAIã€ã§ã€ãƒ¢ãƒ‡ãƒ«ã¯`text-embedding-3-small`ã¨ãªã£ã¦ã„ã¾ã™ã€‚

:::details config_embedding.yaml
```yaml
preferred_provider: azure_openai

providers:
  openai:
    api_key_env: OPENAI_API_KEY
    api_endpoint_env: OPENAI_ENDPOINT
    model: text-embedding-3-small

  gemini:
    api_key_env: GCP_PROJECT
    model: GCP_EMBEDDING_MODEL

  azure_openai:
    api_key_env: AZURE_OPENAI_API_KEY
    api_endpoint_env: AZURE_OPENAI_ENDPOINT
    api_version_env: "2024-10-21"  # Specific API version for embeddings
    model: text-embedding-3-small

  snowflake:
    api_key_env: SNOWFLAKE_PAT
    api_endpoint_env: SNOWFLAKE_ACCOUNT_URL
    api_version_env: "2024-10-01"
    model: snowflake-arctic-embed-m-v1.5
```
:::

- **config_retrieval.yaml**  
  - ã“ã¡ã‚‰ã¯ã€ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã§å‹•ã‹ã™ãŸã‚ã€ã€Œqdrant_localã€ã«å¤‰æ›´ã—ã¾ã™ã€‚
  ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯Azure AI Searchã«ãªã£ã¦ã„ã¾ã™ï¼‰

:::details config_retrieval.yaml
```yaml
preferred_endpoint: qdrant_local

endpoints:
  azure_ai_search:
    api_key_env: AZURE_VECTOR_SEARCH_API_KEY
    api_endpoint_env: AZURE_VECTOR_SEARCH_ENDPOINT
    index_name: embeddings1536
    db_type: azure_ai_search
    name: NLWeb_Crawl

  # Option 1: Local file-based Qdrant storage
  qdrant_local:
    # Use local file-based storage with a specific path
    database_path: "../data/db"
    # Set the collection name to use
    index_name: nlweb_collection
    # Specify the database type
    db_type: qdrant
    
  qdrant_url:
    api_endpoint_env: QDRANT_URL
    api_key_env: QDRANT_API_KEY
    index_name: nlweb_collection
    db_type: qdrant

  snowflake_cortex_search_1:
    api_key_env: SNOWFLAKE_PAT
    api_endpoint_env: SNOWFLAKE_ACCOUNT_URL
    index_name: SNOWFLAKE_CORTEX_SEARCH_SERVICE
    db_type: snowflake_cortex_search
```
:::

### 5. ãƒ™ã‚¯ãƒˆãƒ«ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã¸ã®ãƒ‡ãƒ¼ã‚¿ãƒ­ãƒ¼ãƒ‰

æ¬¡ã«ã€ãƒ­ãƒ¼ã‚«ãƒ«ã®ãƒ™ã‚¯ãƒˆãƒ«ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ã€ãƒ†ã‚¹ãƒˆã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚ä»¥ä¸‹ã¯RSSãƒ•ã‚£ãƒ¼ãƒ‰ã‚’ä½¿ç”¨ã—ãŸä¾‹ã§ã™ã€‚  
â€» è¤‡æ•°ã®RSSãƒ•ã‚£ãƒ¼ãƒ‰ã‚’èª­ã¿è¾¼ã‚€ã¨ã€è¤‡æ•°ã®ã€Œã‚µã‚¤ãƒˆã€ã‚’æ¨ªæ–­ã—ã¦æ¤œç´¢ãŒå¯èƒ½ã«ãªã‚Šã¾ã™ã€‚ç‰¹å®šã®ã‚µã‚¤ãƒˆã«æ¤œç´¢ç¯„å›²ã‚’é™å®šã™ã‚‹å ´åˆã¯`config_nlweb.yaml`ã§è¨­å®šã—ã¾ã™ã€‚

**ä»Šå›ã¯ã€Azureã®æ›´æ–°æƒ…å ±ã®ã‚µã‚¤ãƒˆã®RSSã‚’ä½¿ã„ã¾ã™ã€‚**
https://azure.microsoft.com/ja-jp/updates/

```sh
python -m tools.db_load https://www.microsoft.com/releasecommunications/api/v2/azure/rss azure-update
```

:::details å®Ÿè¡Œçµæœ
```bash
(myenv) PS C:\Users\user001\Documents\poc-nlweb-20250524\NLWeb\code> python -m tools.db_load https://www.microsoft.com/releasecommunications/api/v2/azure/rss azure-update
Logger embedding_wrapper writing to: logs\embedding_wrapper.log at level ERROR
Logger azure_search_client writing to: logs\azure_search_client.log at level ERROR
Logger milvus_client writing to: logs\milvus_client.log at level ERROR
Logger qdrant_client writing to: logs\qdrant_client.log at level ERROR
Logger retriever writing to: logs\retriever.log at level ERROR
Fetching content from URL: https://www.microsoft.com/releasecommunications/api/v2/azure/rss
Fetching content from URL: https://www.microsoft.com/releasecommunications/api/v2/azure/rss 
Saved URL content to temporary file: C:\Users\user01\AppData\Local\Temp\tmpohubzupg.xml (type: rss)
Detected file type: rss, contains embeddings: No
Computing embeddings for file...
Loading data from C:\Users\user01\AppData\Local\Temp\tmpohubzupg.xml (resolved to C:\Users\user01\AppData\Local\Temp\tmpohubzupg.xml) for site azure-update using database endpoint 'qdrant_local'
Detected file type: rss
Using embedding provider: azure_openai, model: text-embedding-3-small
Processing as RSS feed...
Processing RSS/Atom feed: C:\Users\user01\AppData\Local\Temp\tmpohubzupg.xml
Processed 200 episodes from RSS/Atom feed
Computing embeddings for batch of 100 texts
Logger azure_oai_embedding writing to: logs\azure_oai_embedding.log at level ERROR
Uploading batch 1 of 2 (100 documents)
Successfully uploaded batch 1
Processed 100/200 documents
Computing embeddings for batch of 100 texts
Uploading batch 2 of 2 (100 documents)
Successfully uploaded batch 2
Processed 200/200 documents
Loading completed. Added 200 documents to the database.
Saved file with embeddings to ../data/json_with_embeddings\tmpohubzupg.xml
Cleaned up temporary file: C:\Users\user01\AppData\Local\Temp\tmpohubzupg.xml
```
:::

### 6. NLWebã‚µãƒ¼ãƒãƒ¼ã®èµ·å‹•

æº–å‚™ãŒæ•´ã£ãŸã‚‰ã€NLWebã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•ã—ã¾ã™ã€‚  
`code`ãƒ•ã‚©ãƒ«ãƒ€å†…ã§ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚

```sh
python app-file.py
```

---

### 7. å‹•ä½œç¢ºèª

ã‚µãƒ¼ãƒãƒ¼ãŒæ­£å¸¸ã«èµ·å‹•ã—ãŸã‚‰ã€ãƒ–ãƒ©ã‚¦ã‚¶ã§ä»¥ä¸‹ã®URLã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ãã ã•ã„ã€‚
![](/images/poc-nlweb-20250524/2025-05-24-17-55-02.png)

```
http://localhost:8000/
```

ã‚·ãƒ³ãƒ—ãƒ«ãªæ¤œç´¢ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ãŒè¡¨ç¤ºã•ã‚Œã€æ­£å¸¸ã«å‹•ä½œã™ã‚‹ã¯ãšã§ã™ã€‚  
![](/images/poc-nlweb-20250524/2025-05-24-17-55-48.png)

![alt text](/images/poc-nlweb-20250524/NLWeb-Answer-Local.gif)



ã¾ãŸã€ç•°ãªã‚‹ã‚µãƒ³ãƒ—ãƒ«UIã‚’è©¦ã™å ´åˆã¯ã€URLã®ãƒ‘ã‚¹ã«`static/<htmlãƒ•ã‚¡ã‚¤ãƒ«å>`ã‚’è¿½åŠ ã—ã¦ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ã¿ã¦ãã ã•ã„ã€‚

---

## ã¾ã¨ã‚

ä»Šå›ã®æ‰‹é †ã§ã¯ã€NLWebã®ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã§ã®PoCæ‰‹é †ã‚’ç´¹ä»‹ã—ã¾ã—ãŸã€‚ä»¥ä¸‹ã®ã‚¹ãƒ†ãƒƒãƒ—ã‚’é€šã—ã¦ã€
1. **ãƒªãƒã‚¸ãƒˆãƒªã®ã‚¯ãƒ­ãƒ¼ãƒ³ï¼†ä»®æƒ³ç’°å¢ƒã®æ§‹ç¯‰**
2. **ä¾å­˜ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼†ç’°å¢ƒè¨­å®š**
3. **ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã¸ã®ãƒ­ãƒ¼ãƒ‰**
4. **NLWebã‚µãƒ¼ãƒãƒ¼ã®èµ·å‹•ã¨å‹•ä½œç¢ºèª**

ã¨é€²ã‚ã‚‹ã“ã¨ã§ã€NLWebã®åŸºæœ¬æ©Ÿèƒ½ã¨å‹•ä½œç¢ºèªãŒã§ãã¾ã™ã€‚  
åˆã‚ã¦ã®æ–¹ã§ã‚‚ã‚·ãƒ³ãƒ—ãƒ«ãªæ‰‹é †ã§å®Ÿè¡Œå¯èƒ½ã§ã™ã®ã§ã€ãœã²è©¦ã—ã¦ã¿ã¦ãã ã•ã„ã€‚  
ã“ã‚Œã«ã‚ˆã‚Šã€å¯¾è©±å‹ã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆã®æ–°ã—ã„å¯èƒ½æ€§ã‚’å®Ÿéš›ã«ä½“é¨“ã§ãã¾ã™ï¼

Happy Codingï¼ãã—ã¦ã€NLWebã§æœªæ¥ã®ã‚¦ã‚§ãƒ–ä½“é¨“ã‚’æ¥½ã—ã¿ã¾ã—ã‚‡ã†ï¼

# PoCâ‘¡ï¼šNLWebã‚µãƒ¼ãƒãƒ¼ã‚’Azureä¸Šã§å‹•ã‹ã™