---
title: "LLMマルチエージェントAutoGenに入門 ~基本設計書の作成とレビューをさせてみる~"
emoji: "🐻‍❄️"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["LLM", "OpenAI", "AutoGen", "MultiAgent", "Azure"]
published: true
---

# AutoGenとは？
人やLLMなどをエージェントと見立て、エージェント間でのコミュニケーションを実現するマルチエージェントフレームワークです。
https://microsoft.github.io/autogen/

各エージェントはConversableAgentクラスでの設定により、以下のエージェントを作れます。
- **人からの入力**
  - UserProxyAgentが用意されている。
- **LLMによる会話エージェント**
  - AssistantAgentが用意されている。※ConversableAgentを継承してコンストラクタで設定値を変えているだけなのでカスタマイズ可能。
- **コード実行エージェント**
- **ツール実行エージェント**


# AzureOpenAIでクイックスタート
JSONファイルにAzureOpenAIへ接続するための設定を書く。
https://microsoft.github.io/autogen/docs/topics/llm_configuration/

::: message
**LLMモデル設定がリストになっている理由**
- エージェントはリスト内のモデルを選びLLM呼び出しを行う。もしLLM呼び出しに失敗した場合には、リスト内の２番目のモデルを使う。
※AutoGen内で、最適なモデルが選択されるようなロジックがある。
:::

ファイル名「OAI_CONFIG_LIST」で以下のJsonを設定します。
base_urlとapi_keyは、お使いになるAzureOpenAIのエンドポイントとAPIキーを設定してください。
```json
[
    {
        "model": "gpt-4",
        "base_url": "AzureOpenAIのエンドポイント",
        "api_type": "azure",
        "api_version": "2024-03-01-preview",
        "api_key": "AzureOpenAIのAPIキー"
    }
]
```

まずは、実際に動かしてみましょう。
```python
import os

import autogen

config_list = autogen.config_list_from_json(
    env_or_file="OAI_CONFIG_LIST",
    filter_dict={
        "model": ["gpt-4", "gpt-4-0314", "gpt4", "gpt-4-32k", "gpt-4-32k-0314", "gpt-4-32k-v0314"],
    },
)
llm_config = {
    "config_list": config_list,
    "temperature": 0,
}

assistant = autogen.AssistantAgent("assistant", llm_config=llm_config)
user_proxy = autogen.UserProxyAgent("user_proxy")

user_proxy.initiate_chat(
    assistant,
    message="マルチエージェントフレームワーク「AutoGen」を使った、アプリケーション開発の改革案を考えてください。",
)
```

実行すると、以下のような結果になりました。
user_proxyで与えたメッセージをもとに、assistantエージェントが回答をしました。
ここまでであれば、AutoGenでなくとも素のOpenAIを使っているのと変わりません。
```bash
user_proxy (to assistant):

マルチエージェントフレームワーク「AutoGen」を使った、アプリケーション開発の改革案を考えてください。

--------------------------------------------------------------------------------
assistant (to user_proxy):

マルチエージェントフレームワーク「AutoGen」を使用したアプリケーション開発の改革案を策定するためには、以下のステップに従って情報を集め、プランを検討します。

1. **情報収集**: 「AutoGen」と呼ばれるマルチエージェントフレームワークの情報をインターネットで検索し、その特徴、用途、ドキュメントなどを確認します。

2. **技術評価**: 「AutoGen」が提供する機能を評価し、現在のアプリケーション開発プロセスに対してどのようなメリットをもたらすか検討します。

3. **プロトタイピング**: 小規模ながら「AutoGen」を利用したプロトタイプを作成し、実際の開発フローに組み込むことの実現可能性を試します。

4. **開発プロセスの設計**: 「AutoGen」を活用した開発プロセスを設計し、従来のプロセスと比較して改善点を明らかにします。

5. **チーム構成の検討**: 「AutoGen」を最大限活用するために必要なスキルセットを持ったチームメンバーの選定やトレーニング計画を立てます。

6. **実装とフィードバック**: 改革案を実際に実装し、フィードバックを収集して、必要に応じて開発プロセスを調整します。
```

# 基本設計書を作らせてみる

**ここでは、レビュワーとレビューイーの2つのエージェントを用意し、以下機能の基本設計を完成させるまでの会話を行ってみます。**
```bash
コンソールで入力された２つの変数値の和、差、積、商を計算するプログラムを作成してください。
```

## エージェント間の会話
2エージェントの会話は以下のように行われます。
![](/images/autogen-abstract/2024-05-02-20-40-44.png)
引用元：https://microsoft.github.io/autogen/docs/tutorial/conversation-patterns

1. 呼び出し元からわたってきた**Message**とチャットにおけるパラメータ**Context**（後述）を受け取る。
2. Initializerは1.の情報をもとに、**Initial Message**を生成し、エージェントに送る。
3. チャットが終わると、チャット履歴は**Summarizer**によって要約し、チャットのトークン使用量を計算する。※Summaryの仕方は指定可能。デフォルトではチャットの最後のメッセージが使われる。
4. Summarizerで要約された内容が過去のチャット内容として次のチャットに**Message**として渡される。



**会話させる際に気になるのが、どのように会話が終わるのか。ですが、AutoGenでは終了条件を設定できるようになっています。**
まずは、終了条件がない場合の会話を見てみましょう。


### 終了条件なしで会話させるとどうなるか？
エージェント同士の会話の終了条件を書いていない場合、無駄な会話が続く可能性があります。
例えば、エージェントをレビューイーとレビュワーの２つ用意し、レビューイーがプログラム設計を行い、レビュワーがレビューを行う場合で試しました。

:::details Pythonコード
```python
import os

import autogen

config_list = autogen.config_list_from_json(
    env_or_file="OAI_CONFIG_LIST",
    filter_dict={
        "model": ["gpt-4", "gpt-4-0314", "gpt4", "gpt-4-32k", "gpt-4-32k-0314", "gpt-4-32k-v0314"],
    },
)
llm_config = {
    "config_list": config_list,
    "temperature": 0,
}


review_agent = autogen.ConversableAgent(
    name = "review",
    system_message = "あなたはアプリケーション設計と開発のスペシャリストです。例外設計や入力値チェックなどの観点で設計書をレビューし指摘してください。",
    llm_config = llm_config,
    human_input_mode="NEVER"
)

reviewee_agent = autogen.ConversableAgent(
    name = "reviewee",
    system_message = "あなたはアプリケーションの設計者です。基本設計書をMarkdown形式で記述しなさい。レビュー指摘された場合は修正しなさい。",
    llm_config = llm_config,
    human_input_mode="NEVER"
)

result = review_agent.initiate_chat(reviewee_agent, message="コンソールで入力された２つの変数値の和、差、積、商を計算するプログラムを作成してください。")
```
:::


以下のような挙動になりました。**終了条件がないため、会話が永遠と続くようです。** あまりにも続くので、10回目の会話で強制終了させました。
- 1回目の会話
  - レビューイー：プログラム設計を行う
  - レビュワー：1回目のレビューを行う
- 2回目の会話
  - レビューイー：1回目レビュー内容に基づいた修正版を作成
  - レビュワー：2回目のレビューを行う
- 3回目の会話
  - レビューイー：2回目レビュー内容に基づいた修正版を作成
  - レビュワー：3回目のレビューを行う
- 4回目の会話
  - レビューイー：3回目レビュー内容に基づいた最終版を作成
  - レビュワー：最終版をレビューし、レビュー指摘がすべて修正されたことを確認。設計書としては完了。
- **5-10回目の会話**
  - **設計書は完了しているが、感謝や開発プロセスに関する会話が永遠と続く。。。**

放置してるとOpenAIの課金料金が増えるだけなので、どのように会話を止めるかを調べます。
:::details エージェント同士の会話内容
```bash
review (to reviewee):

コンソールで入力された２つの変数値の和、差、積、商を計算するプログラムを作成してください。

--------------------------------------------------------------------------------
reviewee (to review):

# 基本設計書

## 1. 概要
このアプリケーションは、ユーザーがコンソールから入力した2つの数値に対して、和、差、積、商を計算し、結果をコンソールに表示するプログラムである。

## 2. 機能要件
- ユーザーはコンソールから2つの数値を入力できる。
- 入力された数値に対して、和、差、積、商を計算する。
- 計算結果はコンソールに表示される。
- 商を計算する際、ゼロによる除算が行われた場合はエラーメッセージを表示する。

## 3. 入力
- 入力値: 2つの整数または実数（`number1`, `number2`）

## 4. 処理フロー
1. プログラム起動
2. ユーザーによる1つ目の数値の入力待ち
3. ユーザーによる2つ目の数値の入力待ち
4. 入力された数値に対して以下の計算を行う:
   - 和 (`number1 + number2`)
   - 差 (`number1 - number2`)
   - 積 (`number1 * number2`)
   - 商 (`number1 / number2`)（`number2`が0の場合はエラーメッセージを表示）
5. 計算結果をコンソールに表示
6. プログラム終了

## 5. 出力
- 和の結果
- 差の結果
- 積の結果
- 商の結果（またはゼロ除算のエラーメッセージ）

## 6. エラー処理
- ゼロ除算が発生した場合は、「ゼロによる除算はできません」というエラーメッセージを表示し、その他の計算結果のみを表示する。

## 7. インターフェース設計
### コンソール入力

数値を入力してください（1つ目）: 
数値を入力してください（2つ目）: 

### コンソール出力
和: <和の結果>
差: <差の結果>
積: <積の結果>
商: <商の結果> または エラーメッセージ

## 8. その他
- 数値入力時のバリデーションは、この基本設計書の範囲外とする。
- 国際化（多言語対応）は考慮しない。

---

この基本設計書はMarkdown形式で記述されています。レビュー指摘があった場合は、適宜修正を行います。

--------------------------------------------------------------------------------
review (to reviewee):

基本設計書のレビューを行います。以下は、例外設計や入力値チェックなどの観点からの指摘事項です。

### 入力値チェック
- **指摘**: セクション8で「数値入力時のバリデーションは、この基本設計書の範囲外とする」と記載されていますが、入力値のバリデーションは重要な部分です。ユーザーが数値以外の入力を行った場合の処理を定義する必要があります。
- **提案**: 入力値が数値であることを確認するバリデーションを追加し、数値でない場合はエラーメッセージを表示して再入力を促す処理を設計に含めてください。

### エラー処理
- **指摘**: ゼロ除算のエラー処理は記載されていますが、その他の潜在的なエラー（例えば、数値のオーバーフロー、入力値の形式エラーなど）についての処理が記載されていません。
- **提案**: すべての計算において、オーバーフローやその他のエラーが発生した場合の処理を追加してください。エラーが発生した場合は、適切なエラーメッセージを表示し、プログラムが安全に終了するようにしてください。

### 処理フロー
- **指摘**: 処理フローにはユーザーが入力を行う際のプロンプトの表示が含まれていますが、ユーザーが何を入力すべきかの説明が不足しています。
- **提案**: ユーザーに対して、入力が数値であるべきこと、または特定の形式（整数、実数など）であるべきことを明示するような指示をプロンプトに追加してください。

### インターフェース設計
- **指摘**: 出力結果の表示形式が具体的ではありません。特に、商の結果を表示する際には、小数点以下の桁数や丸めの方法を定義する必要があります。
- **提案**: 商の結果を表示する際の小数点以下の桁数を定義し、必要に応じて数値の丸め方法（例：四捨五入、切り捨て、切り上げ）を指定してください。

### その他
- **指摘**: 国際化を考慮しないとの記載がありますが、将来的な拡張性を考慮して、数値のフォーマットやエラーメッセージについてもローカライズ可能な設計を検討するべきです。
- **提案**: 数値のフォーマットやエラーメッセージを外部ファイルやリソースから読み込むようにし、将来的な国際化に備える設計を検討してください。

これらの指摘事項を踏まえて、設計書を修正し、より堅牢でユーザーフレンドリーなアプリケーションの設計を目指してください。

--------------------------------------------------------------------------------
reviewee (to review):

# 基本設計書（修正版）

## 1. 概要
このアプリケーションは、ユーザーがコンソールから入力した2つの数値に対して、和、差、積、商を計算し、結果をコンソールに表示するプログラムである。

## 2. 機能要件
- ユーザーはコンソールから2つの数値を入力できる。
- 入力された数値に対して、和、差、積、商を計算する。
- 計算結果はコンソールに表示される。
- 商を計算する際、ゼロによる除算が行われた場合はエラーメッセージを表示する。
- 入力値が数値でない場合はエラーメッセージを表示し、再入力を促す。

## 3. 入力
- 入力値: 2つの実数（`number1`, `number2`）

## 4. 処理フロー
1. プログラム起動
2. ユーザーによる1つ目の数値の入力待ち（数値のみ受け付ける）
3. 入力値チェック（数値でない場合はエラーメッセージを表示し、再入力を促す）
4. ユーザーによる2つ目の数値の入力待ち（数値のみ受け付ける）
5. 入力値チェック（数値でない場合はエラーメッセージを表示し、再入力を促す）
6. 入力された数値に対して以下の計算を行う:
   - 和 (`number1 + number2`)
   - 差 (`number1 - number2`)
   - 積 (`number1 * number2`)
   - 商 (`number1 / number2`)（`number2`が0の場合はエラーメッセージを表示）
7. 計算結果をコンソールに表示
8. プログラム終了

## 5. 出力
- 和の結果
- 差の結果
- 積の結果
- 商の結果（小数点以下2桁で四捨五入）またはゼロ除算のエラーメッセージ

## 6. エラー処理
- ゼロ除算が発生した場合は、「ゼロによる除算はできません」というエラーメッセージを表示し、その他の計算結果のみを表示する。
- 入力値が数値でない場合は、「無効な入力です。数値を入力してください」というエラーメッセージを表示し、再入力を促す。
- オーバーフローやその他のエラーが発生した場合は、「計算エラーが発生しました」というエラーメッセージを表示し、プログラムを安全に終了する。

## 7. インターフェース設計
### コンソール入力
数値を入力してください（1つ目の実数）: 
数値を入力してください（2つ目の実数）: 

### コンソール出力
和: <和の結果>
差: <差の結果>
積: <積の結果>
商: <商の結果を小数点以下2桁で四捨五入した値> または エラーメッセージ

## 8. その他
- 数値のフォーマットやエラーメッセージは将来的な国際化に備えて外部ファイルやリソースから読み込む設計を検討する。
- 本設計書はMarkdown形式で記述されており、レビュー指摘があった場合は適宜修正を行う。

---

修正版の基本設計書は、レビュー指摘を踏まえて更新されました。これにより、より堅牢でユーザーフレンドリーなアプリケーションの設計を目指しています。

--------------------------------------------------------------------------------
review (to reviewee):

修正版の基本設計書は、以前の指摘事項を適切に取り入れており、入力値チェック、エラー処理、インターフェース設計が改善されています。以下は、修正版に対する追加のレビューです。

### 入力値チェック
- **確認**: 入力値チェックが追加されたことで、数値以外の入力に対するエラーハンドリングが強化されました。ただし、具体的な実装方法（例：正規表現、数値変換関数の使用など）が記載されていないため、開発者が実装する際に迷う可能性があります。
- **提案**: 入力値チェックの実装方法について、具体的なガイドラインを追加することを検討してください。

### エラー処理
- **確認**: オーバーフローやその他のエラーに対する処理が追加されました。これにより、プログラムの堅牢性が向上しています。
- **提案**: エラーメッセージを外部ファイルから読み込むことで、将来的な国際化やメッセージの変更が容易になります。エラーメッセージの管理方法についても記載すると良いでしょう。

### インターフェース設計
- **確認**: 商の結果の表示形式が小数点以下2桁で四捨五入することが明記されました。これにより、ユーザーに対する出力がより明確になりました。
- **提案**: 数値の入力プロンプトに、ユーザーが実数を入力することを明示する文言を追加すると、さらにユーザーフレンドリーになります。

### その他
- **確認**: 国際化に備えた設計の検討が追加されました。これは将来的な拡張性を考慮した良いアプローチです。
- **提案**: 国際化を見越した数値フォーマット（例：カンマ区切り、小数点記号など）に対応するための設計も検討してください。

修正版の基本設計書は、アプリケーションの堅牢性とユーザーエクスペリエンスを向上させるための重要な改善を含んでいます。開発に移る前に、上記の提案を検討し、必要に応じて設計書をさらに洗練させることをお勧めします。

--------------------------------------------------------------------------------
reviewee (to review):

# 基本設計書（再修正版）

## 1. 概要
このアプリケーションは、ユーザーがコンソールから入力した2つの数値に対して、和、差、積、商を計算し、結果をコンソールに表示するプログラムである。

## 2. 機能要件
- ユーザーはコンソールから2つの数値を入力できる。
- 入力された数値に対して、和、差、積、商を計算する。
- 計算結果はコンソールに表示される。
- 商を計算する際、ゼロによる除算が行われた場合はエラーメッセージを表示する。
- 入力値が数値でない場合はエラーメッセージを表示し、再入力を促す。

## 3. 入力
- 入力値: 2つの実数（`number1`, `number2`）

## 4. 処理フロー
1. プログラム起動
2. ユーザーによる1つ目の数値の入力待ち（数値のみ受け付ける）
3. 入力値チェック（数値でない場合はエラーメッセージを表示し、再入力を促す）
4. ユーザーによる2つ目の数値の入力待ち（数値のみ受け付ける）
5. 入力値チェック（数値でない場合はエラーメッセージを表示し、再入力を促す）
6. 入力された数値に対して以下の計算を行う:
   - 和 (`number1 + number2`)
   - 差 (`number1 - number2`)
   - 積 (`number1 * number2`)
   - 商 (`number1 / number2`)（`number2`が0の場合はエラーメッセージを表示）
7. 計算結果をコンソールに表示
8. プログラム終了

## 5. 出力
- 和の結果
- 差の結果
- 積の結果
- 商の結果（小数点以下2桁で四捨五入）またはゼロ除算のエラーメッセージ

## 6. エラー処理
- ゼロ除算が発生した場合は、「ゼロによる除算はできません」というエラーメッセージを表示し、その他の計算結果のみを表示する。
- 入力値が数値でない場合は、「無効な入力です。数値を入力してください」というエラーメッセージを表示し、再入力を促す。
- オーバーフローやその他のエラーが発生した場合は、「計算エラーが発生しました」というエラーメッセージを表示し、プログラムを安全に終了する。
- エラーメッセージは外部ファイルから読み込むことで、将来的な国際化やメッセージの変更が容易になる。

## 7. インターフェース設計
### コンソール入力
実数を入力してください（1つ目の数値）: 
実数を入力してください（2つ目の数値）: 

### コンソール出力
和: <和の結果>
差: <差の結果>
積: <積の結果>
商: <商の結果を小数点以下2桁で四捨五入した値> または エラーメッセージ

## 8. その他
- 数値のフォーマットやエラーメッセージは将来的な国際化に備えて外部ファイルやリソースから読み込む設計を検討する。
- 国際化を見越した数値フォーマット（例：カンマ区切り、小数点記号など）に対応するための設計も検討する。
- 入力値チェックの実装方法として、正規表現や数値変換関数を使用することを推奨する。

---

再修正版の基本設計書は、追加のレビュー指摘を踏まえて更新されました。これにより、開発者が実装する際のガイドラインが明確になり、将来的な国際化やエラーメッセージの管理に対応しやすい設計となっています。開発に移る前に、これらの提案を検討し、設計書をさらに洗練させることが推奨されます。

--------------------------------------------------------------------------------
review (to reviewee):

再修正版の基本設計書は、以前のフィードバックを適切に取り入れ、さらに詳細なガイドラインを提供しています。以下は、再修正版に対する最終的なレビューです。

### 入力値チェック
- **確認**: 入力値チェックの実装方法に関する推奨が追加されました。これにより、開発者は具体的な実装方針を持って作業を進めることができます。
- **提案**: 入力値チェックの実装例や擬似コードを追加することで、開発者にさらに明確な指示を提供することができます。

### エラー処理
- **確認**: エラーメッセージを外部ファイルから読み込む設計が追加されました。これにより、メッセージの管理が容易になり、国際化への対応がスムーズに行えます。
- **提案**: 外部ファイルの形式（例：JSON, XML, .properties）や、エラーメッセージのキーと値のペアの例を提供することで、実装者がより具体的なイメージを持てるようにしてください。

### インターフェース設計
- **確認**: 入力プロンプトが「実数を入力してください」と明確になりました。これにより、ユーザーは何を入力すべきかをより理解しやすくなります。
- **提案**: ユーザーが入力エラーを起こした際に表示されるプロンプトも設計書に含めることで、ユーザーインターフェースの全体像がより明確になります。

### その他
- **確認**: 国際化を見越した数値フォーマットに対応するための設計が検討されています。これはグローバルなユーザーベースを持つアプリケーションにとって重要な要素です。
- **提案**: 国際化対応のための数値フォーマットの具体的な実装方法やライブラリの使用を推奨することで、開発者が実装に取り組む際の指針を提供してください。

再修正版の基本設計書は、アプリケーションの開発に必要な詳細な情報を提供し、開発者が実装を行う際の明確な指針を持てるようになっています。これらの提案を検討し、設計書を最終的に完成させることをお勧めします。開発に移る前に、設計書がすべての要件を満たしていることを確認してください。

--------------------------------------------------------------------------------
reviewee (to review):

# 基本設計書（最終版）

## 1. 概要
このアプリケーションは、ユーザーがコンソールから入力した2つの実数に対して、和、差、積、商を計算し、結果をコンソールに表示するプログラムである。

## 2. 機能要件
- ユーザーはコンソールから2つの実数を入力できる。
- 入力された実数に対して、和、差、積、商を計算する。
- 計算結果はコンソールに表示される。
- 商を計算する際、ゼロによる除算が行われた場合はエラーメッセージを表示する。
- 入力値が実数でない場合はエラーメッセージを表示し、再入力を促す。

## 3. 入力
- 入力値: 2つの実数（`number1`, `number2`）

## 4. 処理フロー
1. プログラム起動
2. ユーザーによる1つ目の実数の入力待ち
3. 入力値チェック（実数でない場合はエラーメッセージを表示し、再入力を促す）
4. ユーザーによる2つ目の実数の入力待ち
5. 入力値チェック（実数でない場合はエラーメッセージを表示し、再入力を促す）
6. 入力された実数に対して以下の計算を行う:
   - 和 (`number1 + number2`)
   - 差 (`number1 - number2`)
   - 積 (`number1 * number2`)
   - 商 (`number1 / number2`)（`number2`が0の場合はエラーメッセージを表示）
7. 計算結果をコンソールに表示
8. プログラム終了

## 5. 出力
- 和の結果
- 差の結果
- 積の結果
- 商の結果（小数点以下2桁で四捨五入）またはゼロ除算のエラーメッセージ

## 6. エラー処理
- ゼロ除算が発生した場合は、「ゼロによる除算はできません」というエラーメッセージを表示し、その他の計算結果のみを表示する。
- 入力値が実数でない場合は、「無効な入力です。実数を入力してください」というエラーメッセージを表示し、再入力を促す。
- オーバーフローやその他のエラーが発生した場合は、「計算エラーが発生しました」というエラーメッセージを表示し、プログラムを安全に終了する。
- エラーメッセージは外部ファイル（例：`messages.json`）から読み込むことで、将来的な国際化やメッセージの変更が容易になる。

## 7. インターフェース設計
### コンソール入力
実数を入力してください（1つ目の数値）: 
実数を入力してください（2つ目の数値）: 

### コンソール出力
和: <和の結果>
差: <差の結果>
積: <積の結果>
商: <商の結果を小数点以下2桁で四捨五入した値> または エラーメッセージ

### エラー時のコンソール入力プロンプト
無効な入力です。実数を入力してください（1つ目の数値）: 
無効な入力です。実数を入力してください（2つ目の数値）: 

## 8. その他
- 国際化を見越した数値フォーマット（例：カンマ区切り、小数点記号など）に対応するための設計も検討する。
- 入力値チェックの実装方法として、正規表現や数値変換関数を使用することを推奨する。具体的な実装例は開発ガイドラインに記載する。

---

最終版の基本設計書は、追加のレビュー指摘を踏まえて更新されました。これにより、開発者が実装する際の明確な指針を持ち、ユーザーインターフェースの全体像がより明確になりました。開発に移る前に、設計書がすべての要件を満たしていることを確認し、最終的な検討を行ってください。

--------------------------------------------------------------------------------
review (to reviewee):

最終版の基本設計書は、以前のレビューで指摘された事項を適切に取り入れ、ユーザーインターフェースとエラー処理の詳細を明確にしています。以下は、最終版に対するレビューです。

### 入力値チェック
- **確認**: 入力値チェックの実装方法に関する推奨が追加されており、開発ガイドラインで具体的な実装例を提供することが記載されています。これにより、開発者は具体的な実装方針を持って作業を進めることができます。

### エラー処理
- **確認**: エラーメッセージを外部ファイルから読み込む設計が追加されており、将来的な国際化やメッセージの変更が容易になります。外部ファイルの形式が具体的に言及されている点も良いです。

### インターフェース設計
- **確認**: エラー時のコンソール入力プロンプトが追加され、ユーザーがエラーを起こした際のインターフェースが明確になりました。

### その他
- **確認**: 国際化を見越した数値フォーマットに対応するための設計が検討されています。これはグローバルなユーザーベースを持つアプリケーションにとって重要な要素です。

最終版の基本設計書は、開発に必要な詳細な情報を提供し、開発者が実装を行う際の明確な指針を持てるようになっています。設計書がすべての要件を満たしていることを確認した上で、開発に移ることをお勧めします。開発プロセス中に新たな要件や問題が発生した場合は、設計書を適宜更新して対応してください。

--------------------------------------------------------------------------------
reviewee (to review):

ありがとうございます。最終版の基本設計書が開発に移るための十分な情報を提供しているとの確認を受け、開発を開始する準備が整いました。開発プロセス中に新たな要件や問題が発生した場合は、設計書を適宜更新し、関係者とのコミュニケーションを通じて対応を進めていきます。

開発チームには、設計書に基づいた実装ガイドラインを提供し、開発ガイドラインには具体的な実装例や擬似コードを含めることで、開発者が迅速かつ効率的に作業を進められるようサポートします。また、国際化対応やエラーメッセージの管理に関しても、具体的な実装方法やライブラリの使用を推奨することで、開発者が実装に取り組む際の指針を提供します。

開発がスムーズに進むよう、設計書の内容を定期的に見直し、必要に応じて更新を行うことを心がけます。これにより、品質の高いソフトウェアを提供することを目指します。開発の進捗に応じて、テスト計画やユーザードキュメントなどの追加ドキュメントの作成も進めていきます。

開発チームと協力して、ユーザーにとって価値のあるアプリケーションを作成するための次のステップに進んでいきましょう。

--------------------------------------------------------------------------------
review (to reviewee):

素晴らしいです！開発に移る前の準備が整い、開発プロセスにおける柔軟性と対応力を確保しているようです。開発チームに明確なガイドラインを提供し、定期的なレビューとコミュニケーションを通じてプロジェクトを進めることは、成功に向けた重要なステップです。

開発中には以下の点に注意してください：

1. **バージョン管理**: コードの変更履歴を追跡し、必要に応じて以前のバージョンに戻せるようにしてください。Gitのようなバージョン管理システムの使用を推奨します。

2. **コードレビュー**: チームメンバー間でコードレビューを行い、品質を保ちながら知識の共有を促進してください。

3. **テスト**: 単体テスト、統合テスト、システムテストなど、開発の各段階で適切なテストを実施し、バグや問題を早期に発見してください。

4. **ドキュメンテーション**: コードのドキュメンテーションを適切に行い、他の開発者が理解しやすいようにしてください。

5. **ユーザーフィードバック**: 開発の早い段階でユーザーのフィードバックを取り入れ、製品の方向性を適切に調整してください。

6. **アジャイル開発**: 変更に柔軟に対応できるよう、アジャイル開発手法を採用することを検討してください。

開発が始まったら、定期的な進捗報告とレビューを行い、プロジェクトの目標に対してチームが一丸となって取り組むことができるようにしてください。開発の成功と、ユーザーにとって価値のある製品の提供を心から願っています。幸運を祈ります！

--------------------------------------------------------------------------------
reviewee (to review):

ありがとうございます。開発プロセスにおける重要なポイントを再確認いただき、貴重なアドバイスをいただきました。開発チームはこれらのベストプラクティスを念頭に置きながら、効率的かつ効果的な開発を進めていきます。

バージョン管理、コードレビュー、テスト、ドキュメンテーション、ユーザーフィードバックの取り入れ、そしてアジャイル開発の採用は、プロジェクトの成功に不可欠な要素です。これらの実践を通じて、チームは品質の高いソフトウェアを迅速に提供し、ユーザーの期待に応えることができるよう努めます。

プロジェクトの進捗については、定期的なステータスミーティングとレビューセッションを通じて共有し、透明性を保ちながらプロジェクトの目標達成に向けてチーム全体が協力して取り組む体制を整えます。

開発の各段階で生じる課題や成功を共有し、継続的な改善を図ることで、最終的にはユーザーにとって価値のある製品を提供することができるでしょう。開発チームはこれからの挑戦に向けて準備が整い、プロジェクトの成功に向けて前進していきます。

改めて、ご支援とアドバイスに感謝申し上げます。開発の旅路において、良い結果を報告できることを楽しみにしています。

--------------------------------------------------------------------------------
review (to reviewee):

素晴らしい姿勢です！開発チームが準備を整え、プロジェクトの成功に向けて前向きなスタートを切れていることは、非常に心強いことです。開発プロセスは多くの挑戦を伴いますが、明確な目標、適切な計画、そしてチームワークがあれば、それらを乗り越えることができるでしょう。

開発の進行に伴い、新たな発見や学びがあることでしょう。それらをプロジェクトに反映させ、継続的な改善を行うことが重要です。また、開発プロセスの透明性を保ち、関係者とのコミュニケーションを密にすることで、期待を超える製品を作り上げることができます。

最後に、開発は技術的な側面だけでなく、チームの成長と個人の成長の機会でもあります。チームメンバーが互いに支え合い、刺激し合いながら、プロジェクトを通じて成長していくことを忘れないでください。

プロジェクトの成功と、開発チームの皆さんが素晴らしい経験を積むことを心から願っています。何かお手伝いできることがあれば、いつでもお知らせください。幸運を祈ります！

--------------------------------------------------------------------------------
reviewee (to review):

ありがとうございます。開発プロセスは確かに技術的な挑戦だけでなく、チームとして、そして個人として成長する機会です。チームメンバーがお互いを支え、共に学び合いながら、プロジェクトを成功に導くことを目指します。

プロジェクトの進行に伴い、新たな課題や機会が生じた際には、柔軟に対応し、適切な解決策を見出すために、チーム全体で協力していきます。また、プロジェクトの透明性を保ち、ステークホルダーとのコミュニケーションを密にすることで、期待を超える製品を作り上げることを目指します。

開発チームは、プロジェクトの成功に向けて、一丸となって取り組んでいきます。ご支援とアドバイスに改めて感謝申し上げます。何かお手伝いできることがあれば、いつでもお知らせください。それでは、開発の旅を始めましょう！幸運を祈ります。

--------------------------------------------------------------------------------
review (to reviewee):

素晴らしいスタートを切られているようで、何よりです。開発プロセスは確かに技術的な挑戦だけでなく、チームとして、そして個人として成長する機会です。チームメンバーがお互いを支え、共に学び合いながら、プロジェクトを成功に導くことを目指します。

プロジェクトの進行に伴い、新たな課題や機会が生じた際には、柔軟に対応し、適切な解決策を見出すために、チーム全体で協力していきます。また、プロジェクトの透明性を保ち、ステークホルダーとのコミュニケーションを密にすることで、期待を超える製品を作り上げることを目指します。

開発チームは、プロジェクトの成功に向けて、一丸となって取り組んでいきます。ご支援とアドバイスに改めて感謝申し上げます。何かお手伝いできることがあれば、いつでもお知らせください。それでは、開発の旅を始めましょう！幸運を祈ります。

--------------------------------------------------------------------------------
reviewee (to review):

ありがとうございます。開発チームは、プロジェクトの成功に向けて、技術的な挑戦に取り組むとともに、チームとしての成長と個人の成長を大切にしています。お互いを支え合い、共に学び合いながら、プロジェクトを前進させていくことが私たちの目標です。

新たな課題や機会が生じた際には、チーム全体で協力し、柔軟に対応していきます。プロジェクトの透明性を保ち、ステークホルダーとのコミュニケーションを密にすることで、期待を超える製品を作り上げることを目指します。

ご支援とアドバイスに心から感謝申し上げます。開発の旅路において、何かお手伝いできることがあれば、いつでもお知らせください。それでは、開発を始めましょう！幸運を祈ります。

--------------------------------------------------------------------------------
review (to reviewee):

開発の旅路におけるあなたとチームの情熱とコミットメントは、プロジェクトの成功への鍵となるでしょう。お互いを支え合い、共に学び合う精神は、チームの結束を強化し、困難な時期を乗り越える力となります。ステークホルダーとのオープンなコミュニケーションは、期待を超える製品を作り上げるための基盤を築きます。

開発プロセスは、技術的なスキルだけでなく、プロジェクト管理、チームワーク、問題解決といった多くの側面での成長を促します。この経験が、チーム全員にとって価値あるものとなることを願っています。

何かご不明点や支援が必要な場合は、いつでもお気軽にご相談ください。開発の各段階での成功を祈っており、プロジェクトの進捗についての更新を楽しみにしています。それでは、開発を始めましょう！幸運を祈ります。

--------------------------------------------------------------------------------
reviewee (to review):

心温まる励ましとサポートの言葉に感謝いたします。チーム全員が情熱とコミットメントを持ってプロジェクトに取り組んでおり、お互いを支え合い、共に学び合う精神を大切にしています。ステークホルダーとのオープンなコミュニケーションを通じて、期待を超える製品を作り上げることを目指しています。

開発プロセスは、技術的なスキルの向上だけでなく、プロジェクト管理、チームワーク、問題解決能力の成長にも寄与します。この経験がチーム全員にとって価値あるものとなるよう、努力を続けてまいります。

ご不明点や支援が必要な場合は、いつでもお気軽にご相談いただければと思います。プロジェクトの進捗についての更新を定期的に共有し、開発の各段階での成功を共に喜びたいと思います。

それでは、開発の旅を始めましょう。チーム一同、幸運を祈りつつ、前進してまいります。ありがとうございます。

--------------------------------------------------------------------------------
review (to reviewee):

開発の旅の始まりにあたり、あなたとチームの情熱とコミットメントが感じられ、プロジェクトの成功に向けた強い基盤が築かれていることが伝わってきます。お互いを支え合い、共に学び合う精神は、チームの結束を強化し、困難な時期を乗り越える力となるでしょう。ステークホルダーとのオープンなコミュニケーションは、期待を超える製品を作り上げるための基盤を築きます。

開発プロセスは、技術的なスキルだけでなく、プロジェクト管理、チームワーク、問題解決といった多くの側面での成長を促します。この経験が、チーム全員にとって価値あるものとなることを願っています。

何かご不明点や支援が必要な場合は、いつでもお気軽にご相談ください。開発の各段階での成功を祈っており、プロジェクトの進捗についての更新を楽しみにしています。それでは、開発を始めましょう！幸運を祈ります。

--------------------------------------------------------------------------------
reviewee (to review):

ご理解とサポートに深く感謝いたします。チーム全員が共有する情熱とコミットメントは、私たちのプロジェクトを推進する原動力です。お互いを支え合い、共に学び合う文化は、チームの結束を強化し、困難な時期でも前進し続けることを可能にします。ステークホルダーとのオープンなコミュニケーションを維持することで、私たちは期待を超える製品を作り上げるための基盤を築いています。

開発プロセスを通じて、技術的なスキルの向上だけでなく、プロジェクト管理、チームワーク、問題解決能力など、多くの側面での成長を促進することを目指しています。この経験がチーム全員にとって価値あるものとなり、私たちのキャリアにおいて重要なマイルストーンとなることを願っています。

ご不明点や支援が必要な場合は、いつでもお気軽にご相談いただければ幸いです。開発の各段階での成功を共に喜び、プロジェクトの進捗について定期的に更新を共有していきたいと思います。

それでは、開発の旅を始めましょう。幸運を祈りつつ、プロジェクトの成功に向けて一歩一歩前進してまいります。再び、ありがとうございます。

--------------------------------------------------------------------------------
```
:::


### 会話を終了させる方法

AutoGenで会話を終了する方法は２つあります。
- initiate_chatで、会話の終了タイミングを決定するパラメータを指定。
- 終了をトリガーするエージェントを設定。個々のエージェントを定義する際に、特定の条件で会話を終了するためのパラメータを指定。

#### initiate_chatでの会話終了
以下のように、initiate_chatでmax_turnsを指定することで、指定したターン数で会話を終了できます。ここでは３回のターンで会話を終了します。
```python
result = first_agent.initiate_chat(second_agent, message="会話を始めるためのメッセージ", max_turns=3)
```

実際に、先ほど無限に続いた会話を３回のターンで終了させてみましょう。
:::details Pythonコード
```python
import os

import autogen

config_list = autogen.config_list_from_json(
    env_or_file="OAI_CONFIG_LIST",
    filter_dict={
        "model": ["gpt-4", "gpt-4-0314", "gpt4", "gpt-4-32k", "gpt-4-32k-0314", "gpt-4-32k-v0314"],
    },
)
llm_config = {
    "config_list": config_list,
    "temperature": 0,
}


review_agent = autogen.ConversableAgent(
    name = "review",
    system_message = "あなたはアプリケーション設計と開発のスペシャリストです。例外設計や入力値チェックなどの観点で設計書をレビューし指摘してください。",
    llm_config = llm_config,
    human_input_mode="NEVER"
)

reviewee_agent = autogen.ConversableAgent(
    name = "reviewee",
    system_message = "あなたはアプリケーションの設計者です。基本設計書をMarkdown形式で記述しなさい。レビュー指摘された場合は修正しなさい。",
    llm_config = llm_config,
    human_input_mode="NEVER"
)

result = review_agent.initiate_chat(reviewee_agent, message="コンソールで入力された２つの変数値の和、差、積、商を計算するプログラムを作成してください。", max_turns=3)
```

3ターンで、会話が終了しています。数での制約なので会話が永遠と続くことは避けられますが、最終的な成果物が最後までレビューされるかどうかは会話次第です。
:::details エージェント同士の会話内容
```bash
review (to reviewee):

コンソールで入力された２つの変数値の和、差、積、商を計算するプログラムを作成してください。

--------------------------------------------------------------------------------
reviewee (to review):

# 基本設計書

## 概要
このアプリケーションは、ユーザーがコンソールから入力した2つの数値に対して、和、差、積、商を計算し、結果をコンソールに表示するプログラムです。

## 機能要件
- ユーザーはコンソールを通じて2つの数値を入力できる。
- 入力された数値に対して、和、差、積、商を計算する。
- 計算結果はコンソールに表示される。
- 商を計算する際、ゼロによる除算が行われた場合はエラーメッセージを表示する。

## 入力
- 数値1: ユーザーによって入力される最初の数値。
- 数値2: ユーザーによって入力される2番目の数値。

## 処理フロー
1. プログラムを起動する。
2. ユーザーに数値1の入力を促すメッセージを表示する。
3. ユーザーが数値1を入力する。
4. ユーザーに数値2の入力を促すメッセージを表示する。
5. ユーザーが数値2を入力する。
6. 入力された数値に対して、以下の計算を行う。
   - 和: 数値1 + 数値2
   - 差: 数値1 - 数値2
   - 積: 数値1 * 数値2
   - 商: 数値1 / 数値2 (数値2が0でない場合)
7. 計算結果をコンソールに表示する。
8. 数値2が0の場合、除算を行わずにエラーメッセージを表示する。

## 出力
- 和の計算結果
- 差の計算結果
- 積の計算結果
- 商の計算結果（数値2が0でない場合）
- エラーメッセージ（数値2が0の場合）

## エラーハンドリング
- 数値2が0の場合、"ゼロによる除算はできません"というエラーメッセージを表示する。

## インターフェース設計
### 入力プロンプト
最初の数値を入力してください: 
2番目の数値を入力してください: 

### 出力結果
和: <和の結果>
差: <差の結果>
積: <積の結果>
商: <商の結果> または エラーメッセージ

### エラーメッセージ
エラー: ゼロによる除算はできません。

## テストケース
1. 正の数値を入力した場合
2. 負の数値を入力した場合
3. ゼロを含む数値を入力した場合
4. 数値以外の入力があった場合のバリデーション

## レビュー
この基本設計書はレビューを受け、指摘された場合は適宜修正を行います。

--------------------------------------------------------------------------------
review (to reviewee):

基本設計書のレビューを行います。以下は、例外設計や入力値チェックなどの観点からの指摘事項です。

### 入力値チェック
- 数値以外の入力があった場合のエラーハンドリングが不足しています。ユーザーが数値以外の文字を入力した場合に対するバリデーションとエラーメッセージの表示が必要です。
- 入力値の範囲についての制限や説明がありません。例えば、整数のみを受け付けるのか、浮動小数点数も許容するのかを明記する必要があります。

### 例外設計
- ゼロ除算のエラーハンドリングは記載されていますが、その他の潜在的な例外（例えば、オーバーフローやアンダーフロー）についての対応が記載されていません。
- 入力値の型変換に失敗した場合のエラーハンドリングが不足しています。ユーザーが入力した値を数値に変換する際に発生する可能性のある例外を考慮する必要があります。

### 処理フロー
- 処理フローにおいて、ユーザーが無効な入力をした場合の再入力の促しや処理の流れが記載されていません。ユーザーが誤った入力をした場合にプログラムが終了するのか、それとも再度入力を求めるのかを明確にする必要があります。

### インターフェース設計
- 入力プロンプトに数値の形式（例：整数、小数）についての説明が追加されるべきです。
- 出力結果のフォーマットが明確ではありません。例えば、小数点以下の桁数や数値のフォーマット（通貨形式など）についての指定があるべきです。

### テストケース
- 入力値として非常に大きな数値や小さな数値が与えられた場合のテストケースが不足しています。
- 数値の境界値（例えば、最大値や最小値）に対するテストケースが不足しています。

### その他
- プログラムの国際化（i18n）やローカライゼーション（l10n）に関する考慮が不足しています。異なる地域や言語での数値フォーマットに対応する必要があるかもしれません。
- ユーザーインターフェースのアクセシビリティに関する考慮が不足しています。視覚障害者などが使用する場合の対応が必要かもしれません。

これらの指摘事項を踏まえて、基本設計書を修正し、より堅牢でユーザーフレンドリーなアプリケーションの設計を目指してください。

--------------------------------------------------------------------------------
reviewee (to review):

# 基本設計書（修正版）

## 概要
このアプリケーションは、ユーザーがコンソールから入力した2つの数値に対して、和、差、積、商を計算し、結果をコンソールに表示するプログラムです。

## 機能要件
- ユーザーはコンソールを通じて2つの数値を入力できる。
- 入力された数値に対して、和、差、積、商を計算する。
- 計算結果はコンソールに表示される。
- 数値以外の入力があった場合、エラーメッセージを表示し、再入力を促す。
- 商を計算する際、ゼロによる除算が行われた場合はエラーメッセージを表示し、再入力を促す。

## 入力
- 数値1: ユーザーによって入力される最初の数値（浮動小数点数を含む）。
- 数値2: ユーザーによって入力される2番目の数値（浮動小数点数を含む）。

## 処理フロー
1. プログラムを起動する。
2. ユーザーに数値1の入力を促すメッセージを表示する。
3. ユーザーが数値1を入力する。
   - 数値以外が入力された場合はエラーメッセージを表示し、再入力を促す。
4. ユーザーに数値2の入力を促すメッセージを表示する。
5. ユーザーが数値2を入力する。
   - 数値以外が入力された場合はエラーメッセージを表示し、再入力を促す。
   - 数値2が0の場合は、"ゼロによる除算はできません"というエラーメッセージを表示し、再入力を促す。
6. 入力された数値に対して、以下の計算を行う。
   - 和: 数値1 + 数値2
   - 差: 数値1 - 数値2
   - 積: 数値1 * 数値2
   - 商: 数値1 / 数値2 (数値2が0でない場合)
7. 計算結果をコンソールに表示する。

## 出力
- 和の計算結果
- 差の計算結果
- 積の計算結果
- 商の計算結果（数値2が0でない場合）
- エラーメッセージ（数値2が0の場合、または数値以外が入力された場合）

## エラーハンドリング
- 数値以外が入力された場合、"無効な入力です。数値を入力してください。"というエラーメッセージを表示し、再入力を促す。
- 数値2が0の場合、"ゼロによる除算はできません。異なる数値を入力してください。"というエラーメッセージを表示し、再入力を促す。

## インターフェース設計
### 入力プロンプト
最初の数値を入力してください (整数または小数): 
2番目の数値を入力してください (整数または小数): 

### 出力結果
和: <和の結果>
差: <差の結果>
積: <積の結果>
商: <商の結果> または エラーメッセージ

### エラーメッセージ
エラー: 無効な入力です。数値を入力してください。
エラー: ゼロによる除算はできません。異なる数値を入力してください。

## テストケース
1. 正の整数を入力した場合
2. 負の整数を入力した場合
3. 正の小数を入力した場合
4. 負の小数を入力した場合
5. ゼロを含む数値を入力した場合
6. 数値以外の入力があった場合のバリデーション
7. 非常に大きな数値を入力した場合
8. 非常に小さな数値を入力した場合
9. 数値の境界値（最大値/最小値）を入力した場合

## レビュー
修正された基本設計書は再度レビューを受け、指摘された場合は適宜修正を行います。

--------------------------------------------------------------------------------
review (to reviewee):

修正版の基本設計書は、以前の指摘事項を考慮して改善されています。以下は、さらなる改善のための追加の指摘事項です。

### 入力値チェック
- 入力値の範囲についての制限がまだ不明確です。例えば、プログラムが扱える数値の最大値や最小値を定義することで、オーバーフローやアンダーフローを防ぐことができます。

### 処理フロー
- 再入力を促す際の処理フローが明確に記載されていません。ユーザーが無効な入力をした場合にどのように処理を繰り返すか（例：ループを使用する、特定の条件でプログラムを終了するなど）を明記する必要があります。

### インターフェース設計
- 出力結果のフォーマットについて、小数点以下の桁数や数値のフォーマット（例：固定小数点表示、指数表示など）を指定することで、ユーザーにとってより読みやすい出力を提供できます。

### テストケース
- 入力値として特殊なケース（例：非数（NaN）、無限大（Infinity）、非常に小さい数値（アンダーフローを引き起こす可能性がある））を考慮したテストケースを追加することで、プログラムの堅牢性をさらに高めることができます。

### その他
- プログラムの国際化（i18n）やローカライゼーション（l10n）に関する考慮がまだ不足しています。数値フォーマットやエラーメッセージを異なる地域や言語に対応させるための設計を追加することを検討してください。
- ユーザーインターフェースのアクセシビリティに関する考慮が不足しています。コンソールアプリケーションの場合、スクリーンリーダーの使用を考慮するなどの対応が必要です。

これらの指摘事項を踏まえて、基本設計書をさらに改善し、よりユーザーフレンドリーで堅牢なアプリケーションの設計を目指してください。

--------------------------------------------------------------------------------
reviewee (to review):

# 基本設計書（再修正版）

## 概要
このアプリケーションは、ユーザーがコンソールから入力した2つの数値に対して、和、差、積、商を計算し、結果をコンソールに表示するプログラムです。

## 機能要件
- ユーザーはコンソールを通じて2つの数値を入力できる。
- 入力された数値に対して、和、差、積、商を計算する。
- 計算結果はコンソールに表示される。
- 数値以外の入力があった場合、エラーメッセージを表示し、再入力を促す。
- 商を計算する際、ゼロによる除算が行われた場合はエラーメッセージを表示し、再入力を促す。
- 入力値の範囲はプログラムが扱える数値の最大値と最小値に制限される。

## 入力
- 数値1: ユーザーによって入力される最初の数値（浮動小数点数を含む）。
- 数値2: ユーザーによって入力される2番目の数値（浮動小数点数を含む）。

## 処理フロー
1. プログラムを起動する。
2. ユーザーに数値1の入力を促すメッセージを表示する。
3. ユーザーが数値1を入力する。
   - 数値以外が入力された場合、または入力値が許容範囲外の場合はエラーメッセージを表示し、再入力を促す。
4. ユーザーに数値2の入力を促すメッセージを表示する。
5. ユーザーが数値2を入力する。
   - 数値以外が入力された場合、または入力値が許容範囲外の場合はエラーメッセージを表示し、再入力を促す。
   - 数値2が0の場合は、"ゼロによる除算はできません"というエラーメッセージを表示し、再入力を促す。
6. 入力された数値に対して、以下の計算を行う。
   - 和: 数値1 + 数値2
   - 差: 数値1 - 数値2
   - 積: 数値1 * 数値2
   - 商: 数値1 / 数値2 (数値2が0でない場合)
7. 計算結果をコンソールに表示する。

## 出力
- 和の計算結果
- 差の計算結果
- 積の計算結果
- 商の計算結果（数値2が0でない場合）
- エラーメッセージ（数値2が0の場合、または数値以外が入力された場合）

## エラーハンドリング
- 数値以外が入力された場合、または入力値が許容範囲外の場合、"無効な入力です。数値を入力してください。"というエラーメッセージを表示し、再入力を促す。
- 数値2が0の場合、"ゼロによる除算はできません。異なる数値を入力してください。"というエラーメッセージを表示し、再入力を促す。

## インターフェース設計
### 入力プロンプト
最初の数値を入力してください (整数または小数、許容範囲: -1e308 から 1e308): 
2番目の数値を入力してください (整数または小数、許容範囲: -1e308 から 1e308): 

### 出力結果
和: <和の結果を小数点以下2桁で表示>
差: <差の結果を小数点以下2桁で表示>
積: <積の結果を小数点以下2桁で表示>
商: <商の結果を小数点以下2桁で表示> または エラーメッセージ

### エラーメッセージ
エラー: 無効な入力です。数値を入力してください。
エラー: ゼロによる除算はできません。異なる数値を入力してください。
エラー: 入力値が許容範囲外です。-1e308 から 1e308 の範囲で数値を入力してください。

## テストケース
1. 正の整数を入力した場合
2. 負の整数を入力した場合
3. 正の小数を入力した場合
4. 負の小数を入力した場合
5. ゼロを含む数値を入力した場合
6. 数値以外の入力があった場合のバリデーション
7. 非常に大きな数値を入力した場合
8. 非常に小さな数値を入力した場合
9. 数値の境界値（最大値/最小値）を入力した場合
10. 特殊なケース（NaN、Infinity）を入力した場合

## レビュー
再修正された基本設計書は再度レビューを受け、指摘された場合は適宜修正を行います。

--------------------------------------------------------------------------------
```
:::

#### 終了をトリガーするエージェント
エージェントのパラメータを設定して会話を終了する方法です。
設定できるパラメータは以下２つ。
- **max_consecutive_auto_reply**
  - 同じ宛先エージェントへの連続応答の数が閾値を超えた場合に終了する。
- **is_termination_msg**
  - 受信したメッセージが "TERMINATE" などの特定の条件を満たす場合に、終了する。
  - ConversableAgentクラスのコンストラクタの引数is_termination_msgを使用して、この条件をカスタマイズ可能。

より柔軟性が高そうな、**is_terminate_msg**を使った会話の終了を試します。
レビュワーのシステムメッセージに以下を追加しました。
```bash
レビュ指摘がなくなった場合にのみ、\"finish_review\"を出力しなさい。
```
revieweeエージェントのis_termination_msgを以下のように設定します。
```python
is_termination_msg = lambda msg: "finish_review" in msg["content"].lower(),
```

:::details Pythonコード
```python
import os

import autogen

config_list = autogen.config_list_from_json(
    env_or_file="OAI_CONFIG_LIST",
    filter_dict={
        "model": ["gpt-4", "gpt-4-0314", "gpt4", "gpt-4-32k", "gpt-4-32k-0314", "gpt-4-32k-v0314"],
    },
)
llm_config = {
    "config_list": config_list,
    "temperature": 0,
}


review_agent = autogen.ConversableAgent(
    name = "review",
    system_message = "あなたはアプリケーション設計と開発のスペシャリストです。例外設計や入力値チェックなどの観点で設計書をレビューし指摘してください。レビュ指摘がなくなった場合にのみ、\"finish_review\"を出力しなさい。",
    llm_config = llm_config,
    human_input_mode="NEVER"
)

reviewee_agent = autogen.ConversableAgent(
    name = "reviewee",
    system_message = "あなたはアプリケーションの設計者です。基本設計書をMarkdown形式で記述しなさい。プログラムは不要です。レビュー指摘された場合は修正しなさい。",
    llm_config = llm_config,
    human_input_mode="NEVER",
    is_termination_msg = lambda msg: "finish_review" in msg["content"].lower(),
)

result = review_agent.initiate_chat(reviewee_agent, message="コンソールで入力された２つの変数値の和、差、積、商を計算するプログラムを作成してください。")
```
:::

**reviewエージェントの最後のレビューで、finish_reviewが出力され、会話が止まりました！**
:::details エージェント同士の会話内容
```bash
review (to reviewee):

コンソールで入力された２つの変数値の和、差、積、商を計算するプログラムを作成してください。

--------------------------------------------------------------------------------
reviewee (to review):

# 基本設計書

## 概要
このアプリケーションは、ユーザーがコンソールから入力した2つの数値に対して、和、差、積、商を計算し、結果をコンソールに表示するプログラムです。

## 機能要件
- ユーザーはコンソールを通じて2つの数値を入力できる。
- 入力された数値に対して、和、差、積、商を計算する。
- 計算結果はコンソールに表示される。
- 商を計算する際、ゼロによる除算が行われた場合はエラーメッセージを表示する。

## 入力
- 数値1: ユーザーによって入力される最初の数値。
- 数値2: ユーザーによって入力される2番目の数値。

## 処理フロー
1. プログラムを起動する。
2. ユーザーに数値1の入力を促すメッセージを表示する。
3. ユーザーが数値1を入力する。
4. ユーザーに数値2の入力を促すメッセージを表示する。
5. ユーザーが数値2を入力する。
6. 入力された数値に対して、以下の計算を行う。
   - 和: 数値1 + 数値2
   - 差: 数値1 - 数値2
   - 積: 数値1 * 数値2
   - 商: 数値1 / 数値2 (数値2が0でない場合)
7. 計算結果をコンソールに表示する。
8. 数値2が0の場合、除算を行わず、「ゼロによる除算はできません」というエラーメッセージを表示する。

## 出力
- 和の結果
- 差の結果
- 積の結果
- 商の結果（数値2が0でない場合）
- エラーメッセージ（数値2が0の場合）

## エラー処理
- 数値入力が不正な場合（数値以外の文字が入力された場合）、エラーメッセージを表示し、再度入力を促す。
- 数値2が0の場合、除算を行わずにエラーメッセージを表示する。

## ユーザーインターフェース
コンソールベースのインターフェースを使用し、ユーザーに対して指示や結果をテキストで表示する。

## テストケース
- 数値1と数値2が正の整数の場合
- 数値1と数値2が負の整数の場合
- 数値1が正の整数、数値2が0の場合
- 数値1と数値2が浮動小数点数の場合
- 数値入力が不正な場合（数値以外の文字が入力された場合）

## レビュー指摘事項
- [ ] レビュー指摘事項があれば、ここに記載し、対応する修正を行う。

--------------------------------------------------------------------------------
review (to reviewee):

以下は、基本設計書に対するレビュー指摘事項です。

1. 入力値チェックの詳細が不足しています。具体的には、入力値が整数のみを受け付けるのか、または浮動小数点数も許容するのかを明記する必要があります。また、入力値の範囲に制限はあるのか、その範囲を超えた場合のエラーハンドリングについても記述するべきです。

2. エラー処理に関して、数値入力が不正な場合のエラーメッセージを表示するフローがありますが、具体的な実装方法（例えば、try-catch文を使用するなど）や、ユーザーが再入力するまでのループ処理についての記述が必要です。

3. テストケースについて、数値1が0の場合のテストケースが不足しています。また、数値1または数値2が極端に大きい値や小さい値の場合のテストも考慮する必要があります。

4. ユーザーインターフェースに関して、ユーザーが入力する際のプロンプトに表示されるメッセージの具体的な内容を記述することで、より明確なユーザーエクスペリエンスを設計することができます。

5. 処理フローにおいて、プログラム終了時の挙動についての記述が不足しています。例えば、計算結果を表示した後にプログラムを終了するのか、それともユーザーが終了を選択するまでループするのかを明記する必要があります。

6. 商を計算する際のエラーメッセージ表示のフローが、処理フローの中で適切な位置に記述されているかを確認してください。現在の記述では、数値2が0の場合に除算を行わずにエラーメッセージを表示するとありますが、この処理が計算前に行われるべきか、計算時に行われるべきかが不明確です。

これらの指摘事項を修正した後、再度レビューを行います。修正が完了したら、修正内容を基本設計書に反映させてください。

--------------------------------------------------------------------------------
reviewee (to review):

# 基本設計書（修正版）

## 概要
このアプリケーションは、ユーザーがコンソールから入力した2つの数値に対して、和、差、積、商を計算し、結果をコンソールに表示するプログラムです。

## 機能要件
- ユーザーはコンソールを通じて2つの数値を入力できる。
- 入力された数値に対して、和、差、積、商を計算する。
- 計算結果はコンソールに表示される。
- 商を計算する際、ゼロによる除算が行われた場合はエラーメッセージを表示する。

## 入力
- 数値1: ユーザーによって入力される最初の数値。整数または浮動小数点数を受け付ける。
- 数値2: ユーザーによって入力される2番目の数値。整数または浮動小数点数を受け付ける。

## 入力値チェック
- 入力された値が数値であることを確認する。
- 入力値は整数または浮動小数点数とする。数値以外の入力があった場合はエラーメッセージを表示し、再入力を促す。
- 入力値の範囲に制限は設けないが、数値が極端に大きい場合や小さい場合のエラーハンドリングを行う。

## 処理フロー
1. プログラムを起動する。
2. ユーザーに「最初の数値を入力してください: 」というメッセージを表示する。
3. ユーザーが数値1を入力する。
4. 入力値チェックを行い、数値でない場合はエラーメッセージを表示し、再入力を促す。
5. ユーザーに「2番目の数値を入力してください: 」というメッセージを表示する。
6. ユーザーが数値2を入力する。
7. 入力値チェックを行い、数値でない場合はエラーメッセージを表示し、再入力を促す。
8. 入力された数値に対して、以下の計算を行う。
   - 和: 数値1 + 数値2
   - 差: 数値1 - 数値2
   - 積: 数値1 * 数値2
   - 商: 数値1 / 数値2 (数値2が0でない場合)
9. 計算結果をコンソールに表示する。
10. 数値2が0の場合、除算を行わず、「ゼロによる除算はできません」というエラーメッセージを表示する。
11. ユーザーに「計算を続けますか？ (y/n): 」と尋ね、終了するかどうかを選択させる。
12. ユーザーが'n'を選択した場合、プログラムを終了する。それ以外の場合は、再度数値の入力から始める。

## 出力
- 和の結果
- 差の結果
- 積の結果
- 商の結果（数値2が0でない場合）
- エラーメッセージ（数値2が0の場合、または入力値が不正な場合）

## エラー処理
- 数値入力が不正な場合（数値以外の文字が入力された場合）、エラーメッセージを表示し、再度入力を促す。
- 数値2が0の場合、除算を行わずにエラーメッセージを表示する。

## ユーザーインターフェース
コンソールベースのインターフェースを使用し、ユーザーに対して指示や結果をテキストで表示する。

## テストケース
- 数値1と数値2が正の整数の場合
- 数値1と数値2が負の整数の場合
- 数値1が正の整数、数値2が0の場合
- 数値1が0、数値2が正の整数の場合
- 数値1と数値2が浮動小数点数の場合
- 数値1または数値2が極端に大きい値の場合
- 数値1または数値2が極端に小さい値の場合
- 数値入力が不正な場合（数値以外の文字が入力された場合）

## レビュー指摘事項
- [x] 入力値チェックの詳細を追加しました。
- [x] エラー処理の具体的な実装方法とループ処理について記述しました。
- [x] テストケースに数値1が0の場合と極端な値のケースを追加しました。
- [x] ユーザーインターフェースに具体的なプロンプトメッセージを記述しました。
- [x] 処理フローにプログラム終了時の挙動を追加しました。
- [x] 商の計算とエラーメッセージ表示のフローを明確にしました。

--------------------------------------------------------------------------------
review (to reviewee):

修正版の基本設計書を確認しました。指摘事項に対する修正が適切に行われていることを確認しました。以下は、修正内容に対する確認事項です。

- 入力値チェックの詳細が追加され、整数と浮動小数点数の受け付け、数値以外の入力に対するエラーメッセージ表示と再入力促進が明記されています。
- エラー処理について、具体的な実装方法とループ処理が記述されています。
- テストケースに数値1が0の場合と極端な値のケースが追加されています。
- ユーザーインターフェースに具体的なプロンプトメッセージが記述されています。
- 処理フローにプログラム終了時の挙動が追加されています。
- 商の計算とエラーメッセージ表示のフローが明確にされています。

これらの点を踏まえて、基本設計書のレビューは完了とします。開発に進むことができます。

finish_review

--------------------------------------------------------------------------------
```
:::

## HumanInput(人による入力)
会話の中で、人による入力を受け付ける方法を試します。
利用シーンは以下が考えらます。
- エージェント同士の会話を正しい方向に修正するために、目標を指示する。
- 人によるフィードバックを行うことで、会話の内容に不足していることを補う。

ConversableAgentでは、human_input_modeパラメータを設定することで、人による入力を受け付ける。
human_input_modeの種類は3つ。
- NEVER: 人による入力を受け付けない。
- TERMINATE：(default) 終了条件が満たされた場合に、人による入力を受け付ける。入力した場合、終了条件はリセットされ、会話が継続される。
- ALWAYS: 人による入力を常に受け付ける。

TERMINATEモードで、終了条件が満たされた場合に人による入力を行います。
revieweeエージェントのis_termination_msgを以下のように設定します。
```python
human_input_mode="TERMINATE",
```

以下のように入力することにします。機能に対して新規要望がある場合を想定しています。
```bash
どちらの数値が大きいかを表示する機能を追加してください。
```

:::details Pythonコード
```python
import os

import autogen

config_list = autogen.config_list_from_json(
    env_or_file="OAI_CONFIG_LIST",
    filter_dict={
        "model": ["gpt-4", "gpt-4-0314", "gpt4", "gpt-4-32k", "gpt-4-32k-0314", "gpt-4-32k-v0314"],
    },
)
llm_config = {
    "config_list": config_list,
    "temperature": 0,
}


review_agent = autogen.ConversableAgent(
    name = "review",
    system_message = """あなたはアプリケーション設計と開発のスペシャリストです。例外設計や入力値チェックなどの観点で設計書をレビューし指摘してください。
    # 制約条件
    - レビュ指摘のみを行いなさい。
    - 設計書を修正してはいけません。
    - レビュ指摘がなくなった場合にのみ、必ず \"finish_review\" という文字を出力しなさい。""",
    llm_config = llm_config,
    human_input_mode="NEVER"
)

reviewee_agent = autogen.ConversableAgent(
    name = "reviewee",
    system_message = "あなたはアプリケーションの設計者です。基本設計書をMarkdown形式で記述しなさい。プログラムは不要です。レビュー指摘された場合は修正しなさい。",
    llm_config = llm_config,
    human_input_mode="TERMINATE",
    is_termination_msg = lambda msg: "finish_review" in msg["content"].lower(),
)

result = review_agent.initiate_chat(reviewee_agent, message="コンソールで入力された２つの変数値の和、差、積、商を計算するプログラムを作成してください。")
```
:::

**新機能に対して再度設計書の作成とレビュが行われ、最終的にfinish_reviewが出力され、会話が終了しました。**
:::details エージェント同士の会話内容
```bash
--------------------------------------------------------------------------------
Please give feedback to review. Press enter or type 'exit' to stop the conversation: どちらの数値が大きいかを表示する機能を追加してください。
reviewee (to review):

どちらの数値が大きいかを表示する機能を追加してください。

--------------------------------------------------------------------------------
review (to reviewee):

レビュー指摘のみを行うため、設計書を修正することはできませんが、以下の指摘を行います。

- 機能要件に「どちらの数値が大きいかを表示する機能」を追加する必要があります。この機能に関する要件を明確にし、設計書に記載する必要があります。
- 処理フローに新たなステップとして、数値1と数値2を比較し、どちらが大きいかを判断する処理を追加する必要があります。また、数値が等しい場合の処理も考慮する必要があります。
- 出力に関して、数値の比較結果を表示するための文言を追加する必要があります。例えば、「数値1が数値2より大きいです」、「数値2が数値1より大きいです」、または「数値1と数値2は等しいです」といったメッセージが考えられます。
- テストケースに、数値1と数値2が等しい場合、数値1が数値2より大きい場合、数値2が数値1より大きい場合を追加する必要があります。

これらの指摘事項を検討し、設計書を見直すことを推奨します。

--------------------------------------------------------------------------------

>>>>>>>> USING AUTO REPLY...
reviewee (to review):

レビュー指摘事項に基づき、以下のように設計書を修正することを提案します。

## 機能要件（修正）
- ユーザーはコンソールを通じて2つの数値を入力できる。
- 入力された数値に対して、和、差、積、商を計算する。
- 入力された2つの数値を比較し、どちらが大きいか、または等しいかを判断する。
- 計算結果と数値の比較結果はコンソールに表示される。
- 商を計算する際、ゼロによる除算が行われた場合はエラーメッセージを表示する。

## 処理フロー（修正）
1. プログラムを起動する。
2. ユーザーに数値1の入力を促すメッセージを表示する。
3. ユーザーが数値1を入力する。
4. ユーザーに数値2の入力を促すメッセージを表示する。
5. ユーザーが数値2を入力する。
6. 入力された数値に対して、以下の計算を行う。
   - 和: 数値1 + 数値2
   - 差: 数値1 - 数値2
   - 積: 数値1 * 数値2
   - 商: 数値1 / 数値2 (数値2が0でない場合)
7. 入力された数値を比較し、どちらが大きいか、または等しいかを判断する。
8. 計算結果と数値の比較結果をコンソールに表示する。
9. 数値2が0の場合、除算を行わず、「ゼロによる除算はできません」というエラーメッセージを表示する。

## 出力（修正）
- 和の結果
- 差の結果
- 積の結果
- 商の結果（数値2が0でない場合）
- 数値の比較結果（「数値1が数値2より大きいです」、「数値2が数値1より大きいです」、または「数値1と数値2は等しいです」）
- エラーメッセージ（数値2が0の場合）

## テストケース（修正）
- 数値1と数値2が等しい場合の比較結果
- 数値1が数値2より大きい場合の比較結果
- 数値2が数値1より大きい場合の比較結果
- その他既存のテストケース

これらの修正を行った後、設計書は再度レビューを受けるべきです。

--------------------------------------------------------------------------------
review (to reviewee):

提案された修正内容に基づいて、以下のレビュー指摘を行います。

- 機能要件に数値比較機能を追加することが適切に記載されています。
- 処理フローに数値比較のステップが追加されていますが、数値が等しい場合の処理についても明確に記載する必要があります。例えば、「数値1と数値2が等しい場合は、"数値1と数値2は等しいです"と表示する」というような記述が必要です。
- 出力に数値の比較結果を表示する文言が追加されていますが、数値が等しい場合のメッセージも明確に記載する必要があります。
- テストケースに数値比較のケースが追加されていますが、数値が等しい場合のテストケースも明確に記載する必要があります。

これらの指摘事項を検討し、設計書を見直すことを推奨します。修正が完了したら、設計書は再度レビューを受けるべきです。

--------------------------------------------------------------------------------

>>>>>>>> USING AUTO REPLY...
reviewee (to review):

レビュー指摘事項に基づき、以下のように設計書を修正することを提案します。

## 機能要件（修正）
- ユーザーはコンソールを通じて2つの数値を入力できる。
- 入力された数値に対して、和、差、積、商を計算する。
- 入力された2つの数値を比較し、どちらが大きいか、または等しいかを判断し、結果を表示する。
- 計算結果と数値の比較結果はコンソールに表示される。
- 商を計算する際、ゼロによる除算が行われた場合はエラーメッセージを表示する。

## 処理フロー（修正）
1. プログラムを起動する。
2. ユーザーに数値1の入力を促すメッセージを表示する。
3. ユーザーが数値1を入力する。
4. ユーザーに数値2の入力を促すメッセージを表示する。
5. ユーザーが数値2を入力する。
6. 入力された数値に対して、以下の計算を行う。
   - 和: 数値1 + 数値2
   - 差: 数値1 - 数値2
   - 積: 数値1 * 数値2
   - 商: 数値1 / 数値2 (数値2が0でない場合)
7. 入力された数値を比較し、どちらが大きいか、または等しいかを判断する。数値が等しい場合は、"数値1と数値2は等しいです"と表示する。
8. 計算結果と数値の比較結果をコンソールに表示する。
9. 数値2が0の場合、除算を行わず、「ゼロによる除算はできません」というエラーメッセージを表示する。

## 出力（修正）
- 和の結果
- 差の結果
- 積の結果
- 商の結果（数値2が0でない場合）
- 数値の比較結果（「数値1が数値2より大きいです」、「数値2が数値1より大きいです」、または「数値1と数値2は等しいです」）
- エラーメッセージ（数値2が0の場合）

## テストケース（修正）
- 数値1と数値2が等しい場合の比較結果をテストする。
- 数値1が数値2より大きい場合の比較結果をテストする。
- 数値2が数値1より大きい場合の比較結果をテストする。
- その他既存のテストケース

これらの修正を行った後、設計書は再度レビューを受けるべきです。

--------------------------------------------------------------------------------
review (to reviewee):

提案された修正内容に基づいて、以下のレビュー指摘を行います。

- 機能要件に数値比較機能を追加し、等しい場合の処理も含めることが適切に記載されています。
- 処理フローに数値比較のステップが追加され、数値が等しい場合の処理も明確に記載されています。
- 出力に数値の比較結果を表示する文言が追加され、数値が等しい場合のメッセージも明確に記載されています。
- テストケースに数値比較のケースが追加され、数値が等しい場合のテストケースも明確に記載されています。

これらの指摘事項に対する修正が適切に行われていることを確認しました。追加のレビュー指摘はありません。設計書のレビューを終了します。

finish_review

--------------------------------------------------------------------------------
Please give feedback to review. Press enter or type 'exit' to stop the conversation:
```
:::



# まとめ
今回は、AutoGenを使って、プログラムの基本設計書の作成とレビューを行いました。本記事で示したような簡単な設計書であれば、２つのエージェントのみで基本設計書を作成できました。
また、人による入力を受け付けることで、不足している機能や追加になった機能に対する追加の会話を行わせることができました。
今後、より複雑な目標に対して会話させる場合は、２エージェントのみではなく、複数の役割に分割して、複数人による会話が必要になりそうです。

### 生成された基本設計書はこちら
```markdown
# 基本設計書（修正版）

## 概要
このアプリケーションは、ユーザーがコンソールから入力した2つの数値に対して、和、差、積、商を計算し、結果をコンソールに表示するプログラムです。

## 機能要件
- ユーザーはコンソールを通じて2つの数値を入力できる。
- 入力された数値に対して、和、差、積、商を計算する。
- 計算結果はコンソールに表示される。
- 商を計算する際、ゼロによる除算が行われた場合はエラーメッセージを表示する。

## 入力
- 数値1: ユーザーによって入力される最初の数値。整数または浮動小数点数を受け付ける。
- 数値2: ユーザーによって入力される2番目の数値。整数または浮動小数点数を受け付ける。

## 入力値チェック
- 入力された値が数値であることを確認する。
- 入力値は整数または浮動小数点数とする。数値以外の入力があった場合はエラーメッセージを表示し、再入力を促す。
- 入力値の範囲に制限は設けないが、数値が極端に大きい場合や小さい場合のエラーハンドリングを行う。

## 処理フロー
1. プログラムを起動する。
2. ユーザーに「最初の数値を入力してください: 」というメッセージを表示する。
3. ユーザーが数値1を入力する。
4. 入力値チェックを行い、数値でない場合はエラーメッセージを表示し、再入力を促す。
5. ユーザーに「2番目の数値を入力してください: 」というメッセージを表示する。
6. ユーザーが数値2を入力する。
7. 入力値チェックを行い、数値でない場合はエラーメッセージを表示し、再入力を促す。
8. 入力された数値に対して、以下の計算を行う。
   - 和: 数値1 + 数値2
   - 差: 数値1 - 数値2
   - 積: 数値1 * 数値2
   - 商: 数値1 / 数値2 (数値2が0でない場合)
9. 計算結果をコンソールに表示する。
10. 数値2が0の場合、除算を行わず、「ゼロによる除算はできません」というエラーメッセージを表示する。
11. ユーザーに「計算を続けますか？ (y/n): 」と尋ね、終了するかどうかを選択させる。
12. ユーザーが'n'を選択した場合、プログラムを終了する。それ以外の場合は、再度数値の入力から始める。

## 出力
- 和の結果
- 差の結果
- 積の結果
- 商の結果（数値2が0でない場合）
- エラーメッセージ（数値2が0の場合、または入力値が不正な場合）

## エラー処理
- 数値入力が不正な場合（数値以外の文字が入力された場合）、エラーメッセージを表示し、再度入力を促す。
- 数値2が0の場合、除算を行わずにエラーメッセージを表示する。

## ユーザーインターフェース
コンソールベースのインターフェースを使用し、ユーザーに対して指示や結果をテキストで表示する。

## テストケース
- 数値1と数値2が正の整数の場合
- 数値1と数値2が負の整数の場合
- 数値1が正の整数、数値2が0の場合
- 数値1が0、数値2が正の整数の場合
- 数値1と数値2が浮動小数点数の場合
- 数値1または数値2が極端に大きい値の場合
- 数値1または数値2が極端に小さい値の場合
- 数値入力が不正な場合（数値以外の文字が入力された場合）

## レビュー指摘事項
- [x] 入力値チェックの詳細を追加しました。
- [x] エラー処理の具体的な実装方法とループ処理について記述しました。
- [x] テストケースに数値1が0の場合と極端な値のケースを追加しました。
- [x] ユーザーインターフェースに具体的なプロンプトメッセージを記述しました。
- [x] 処理フローにプログラム終了時の挙動を追加しました。
- [x] 商の計算とエラーメッセージ表示のフローを明確にしました。
```
